# Triage

Windows TOML collection focusing on quickly collecting data related to a Windows
alert.

```toml
system = "windows"

[output]
name = "triage_collection"
directory = "./tmp"
format = "json"
compress = true
endpoint_id = "6c51b123-1522-4572-9f2a-0bd5abd81b82"
collection_id = 1
output = "local"

[[artifacts]]
artifact_name = "processes"
[artifacts.processes]
md5 = true
sha1 = false
sha256 = false
metadata = true

[[artifacts]]
artifact_name = "prefetch"
[artifacts.prefetch]

[[artifacts]]
artifact_name = "userassist"
[artifacts.userassist]

[[artifacts]]
artifact_name = "script"
[artifacts.script]
name = "office_mru"
# Pulls back recently opened Office documents for all users from NTUSER.DAT files
script = "Ly8gLi4vLi4vYXJ0ZW1pcy1hcGkvc3JjL3dpbmRvd3MvcmVnaXN0cnkudHMKZnVuY3Rpb24gZ2V0X3JlZ2lzdHJ5KHBhdGgpIHsKICBjb25zdCBkYXRhID0gRGVub1tEZW5vLmludGVybmFsXS5jb3JlLm9wcy5nZXRfcmVnaXN0cnkocGF0aCk7CiAgY29uc3QgcmVnX2FycmF5ID0gSlNPTi5wYXJzZShkYXRhKTsKICByZXR1cm4gcmVnX2FycmF5Owp9CgovLyAuLi8uLi9hcnRlbWlzLWFwaS9tb2QudHMKZnVuY3Rpb24gZ2V0UmVnaXN0cnkocGF0aCkgewogIHJldHVybiBnZXRfcmVnaXN0cnkocGF0aCk7Cn0KCi8vIG1haW4udHMKZnVuY3Rpb24gbWFpbigpIHsKICBjb25zdCBkcml2ZSA9IERlbm8uZW52LmdldCgiU3lzdGVtRHJpdmUiKTsKICBpZiAoZHJpdmUgPT09IHZvaWQgMCkgewogICAgcmV0dXJuIFtdOwogIH0KICBjb25zdCBvZmZpY2VfYXJyYXkgPSBbXTsKICBjb25zdCB1c2VycyA9IGAke2RyaXZlfVxcVXNlcnNgOwogIGZvciAoY29uc3QgZW50cnkgb2YgRGVuby5yZWFkRGlyU3luYyh1c2VycykpIHsKICAgIHRyeSB7CiAgICAgIGNvbnN0IHBhdGggPSBgJHt1c2Vyc31cXCR7ZW50cnkubmFtZX1cXE5UVVNFUi5EQVRgOwogICAgICBjb25zdCBzdGF0dXMgPSBEZW5vLmxzdGF0U3luYyhwYXRoKTsKICAgICAgaWYgKCFzdGF0dXMuaXNGaWxlKSB7CiAgICAgICAgY29udGludWU7CiAgICAgIH0KICAgICAgY29uc3QgcmVnX3Jlc3VsdHMgPSBnZXRSZWdpc3RyeShwYXRoKTsKICAgICAgZm9yIChjb25zdCByZWdfZW50cnkgb2YgcmVnX3Jlc3VsdHMpIHsKICAgICAgICBpZiAoIXJlZ19lbnRyeS5wYXRoLm1hdGNoKAogICAgICAgICAgL01pY3Jvc29mdFxcT2ZmaWNlXFwxKDR8NXw2KVwuMFxcLipcXChGaWxlIE1SVXwgVXNlciBNUlVcXC4qXFxGaWxlIE1SVSkvCiAgICAgICAgKSkgewogICAgICAgICAgY29udGludWU7CiAgICAgICAgfQogICAgICAgIGZvciAoY29uc3QgdmFsdWUgb2YgcmVnX2VudHJ5LnZhbHVlcykgewogICAgICAgICAgaWYgKCF2YWx1ZS52YWx1ZS5pbmNsdWRlcygiSXRlbSAiKSkgewogICAgICAgICAgICBjb250aW51ZTsKICAgICAgICAgIH0KICAgICAgICAgIGNvbnN0IHdpbmRvd3NfbmFubyA9IDFlNzsKICAgICAgICAgIGNvbnN0IHNlY29uZHNfdG9fdW5peCA9IDExNjQ0NDczNjAwOwogICAgICAgICAgY29uc3QgZmlsZXRpbWUgPSBwYXJzZUludCgKICAgICAgICAgICAgdmFsdWUuZGF0YS5zcGxpdCgiW1QiKVsxXS5zcGxpdCgiXSIpWzBdLAogICAgICAgICAgICAxNgogICAgICAgICAgKTsKICAgICAgICAgIGNvbnN0IHVuaXhlcG9jaCA9IGZpbGV0aW1lIC8gd2luZG93c19uYW5vIC0gc2Vjb25kc190b191bml4OwogICAgICAgICAgY29uc3QgbXJ1ID0gewogICAgICAgICAgICBmaWxlX3BhdGg6IHZhbHVlLmRhdGEuc3BsaXQoIioiKVsxXSwKICAgICAgICAgICAgcmVnX3BhdGg6IHJlZ19lbnRyeS5wYXRoLAogICAgICAgICAgICBsYXN0X29wZW5lZDogdW5peGVwb2NoLAogICAgICAgICAgICBsYXN0X29wZW5lZF9maWxldGltZTogZmlsZXRpbWUsCiAgICAgICAgICAgIHJlZ19maWxlX3BhdGg6IHBhdGgKICAgICAgICAgIH07CiAgICAgICAgICBvZmZpY2VfYXJyYXkucHVzaChtcnUpOwogICAgICAgIH0KICAgICAgfQogICAgfSBjYXRjaCAoX2UpIHsKICAgICAgY29udGludWU7CiAgICB9CiAgfQogIHJldHVybiBvZmZpY2VfYXJyYXk7Cn0KbWFpbigpOwo="

[[artifacts]]
artifact_name = "script"
[artifacts.script]
name = "recent_files"
# Parses all recent accessed files (shortcuts/lnk files) for all users
script = "Ly8gZGVuby1mbXQtaWdub3JlLWZpbGUKLy8gZGVuby1saW50LWlnbm9yZS1maWxlCi8vIFRoaXMgY29kZSB3YXMgYnVuZGxlZCB1c2luZyBgZGVubyBidW5kbGVgIGFuZCBpdCdzIG5vdCByZWNvbW1lbmRlZCB0byBlZGl0IGl0IG1hbnVhbGx5CgpmdW5jdGlvbiBnZXRfbG5rX2ZpbGUocGF0aCkgewogICAgY29uc3QgZGF0YSA9IERlbm9bRGVuby5pbnRlcm5hbF0uY29yZS5vcHMuZ2V0X2xua19maWxlKHBhdGgpOwogICAgY29uc3QgbG5rID0gSlNPTi5wYXJzZShkYXRhKTsKICAgIHJldHVybiBsbms7Cn0KZnVuY3Rpb24gZ2V0TG5rRmlsZShwYXRoKSB7CiAgICByZXR1cm4gZ2V0X2xua19maWxlKHBhdGgpOwp9CmZ1bmN0aW9uIG1haW4oKSB7CiAgICBjb25zdCBkcml2ZSA9IERlbm8uZW52LmdldCgiU3lzdGVtRHJpdmUiKTsKICAgIGlmIChkcml2ZSA9PT0gdW5kZWZpbmVkKSB7CiAgICAgICAgcmV0dXJuIFtdOwogICAgfQogICAgY29uc3QgdXNlcnMgPSBgJHtkcml2ZX1cXFVzZXJzYDsKICAgIGNvbnN0IHJlY2VudF9maWxlcyA9IFtdOwogICAgZm9yIChjb25zdCBlbnRyeSBvZiBEZW5vLnJlYWREaXJTeW5jKHVzZXJzKSl7CiAgICAgICAgdHJ5IHsKICAgICAgICAgICAgY29uc3QgcGF0aCA9IGAke3VzZXJzfVxcJHtlbnRyeS5uYW1lfVxcQXBwRGF0YVxcUm9hbWluZ1xcTWljcm9zb2Z0XFxXaW5kb3dzXFxSZWNlbnRgOwogICAgICAgICAgICBmb3IgKGNvbnN0IGVudHJ5IG9mIERlbm8ucmVhZERpclN5bmMocGF0aCkpewogICAgICAgICAgICAgICAgaWYgKCFlbnRyeS5uYW1lLmVuZHNXaXRoKCJsbmsiKSkgewogICAgICAgICAgICAgICAgICAgIGNvbnRpbnVlOwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgY29uc3QgbG5rX2ZpbGUgPSBgJHtwYXRofVxcJHtlbnRyeS5uYW1lfWA7CiAgICAgICAgICAgICAgICBjb25zdCBsbmsgPSBnZXRMbmtGaWxlKGxua19maWxlKTsKICAgICAgICAgICAgICAgIHJlY2VudF9maWxlcy5wdXNoKGxuayk7CiAgICAgICAgICAgIH0KICAgICAgICB9IGNhdGNoIChfZXJyb3IpIHsKICAgICAgICAgICAgY29udGludWU7CiAgICAgICAgfQogICAgfQogICAgcmV0dXJuIHJlY2VudF9maWxlczsKfQptYWluKCk7Cgo="

[[artifacts]]
artifact_name = "script"
[artifacts.script]
name = "logons_7_days"
# Pulls back all logons within the past seven (7) days (logoffs are not included)
script = "Ly8gLi4vLi4vYXJ0ZW1pcy1hcGkvc3JjL3dpbmRvd3MvZXZlbnRsb2dzLnRzCmZ1bmN0aW9uIGdldF9ldmVudGxvZ3MocGF0aCkgewogIGNvbnN0IGRhdGEgPSBEZW5vW0Rlbm8uaW50ZXJuYWxdLmNvcmUub3BzLmdldF9ldmVudGxvZ3MocGF0aCk7CiAgY29uc3QgbG9nX2FycmF5ID0gSlNPTi5wYXJzZShkYXRhKTsKICByZXR1cm4gbG9nX2FycmF5Owp9CgovLyAuLi8uLi9hcnRlbWlzLWFwaS9tb2QudHMKZnVuY3Rpb24gZ2V0RXZlbnRMb2dzKHBhdGgpIHsKICByZXR1cm4gZ2V0X2V2ZW50bG9ncyhwYXRoKTsKfQoKLy8gbWFpbi50cwpmdW5jdGlvbiBtYWluKCkgewogIGNvbnN0IHBhdGggPSAiQzpcXFdpbmRvd3NcXFN5c3RlbTMyXFx3aW5ldnRcXExvZ3NcXFNlY3VyaXR5LmV2dHgiOwogIGNvbnN0IHJlY29yZHMgPSBnZXRFdmVudExvZ3MocGF0aCk7CiAgY29uc3QgbG9nb25zID0gW107CiAgY29uc3QgdGltZV9ub3cgPSBuZXcgRGF0ZSgpOwogIGNvbnN0IG1pbGxpc2Vjb25kcyA9IHRpbWVfbm93LmdldFRpbWUoKTsKICBjb25zdCBuYW5vc2Vjb25kcyA9IG1pbGxpc2Vjb25kcyAqIDFlNjsKICBjb25zdCBzZXZlbl9kYXlzID0gNjA0OGUxMTsKICBjb25zdCBzdGFydF9sb2dvbnMgPSBuYW5vc2Vjb25kcyAtIHNldmVuX2RheXM7CiAgZm9yIChjb25zdCByZWNvcmQgb2YgcmVjb3JkcykgewogICAgaWYgKHJlY29yZC5kYXRhWyJFdmVudCJdWyJTeXN0ZW0iXVsiRXZlbnRJRCJdICE9IDQ2MjQgJiYgcmVjb3JkLmRhdGFbIkV2ZW50Il1bIlN5c3RlbSJdWyJFdmVudElEIl1bIiN0ZXh0Il0gIT0gNDYyNCkgewogICAgICBjb250aW51ZTsKICAgIH0KICAgIGlmIChyZWNvcmQudGltZXN0YW1wIDwgc3RhcnRfbG9nb25zKSB7CiAgICAgIGNvbnRpbnVlOwogICAgfQogICAgY29uc3QgZW50cnkgPSB7CiAgICAgIHRpbWVzdGFtcDogcmVjb3JkLnRpbWVzdGFtcCwKICAgICAgdGFyZ2V0X3NpZDogcmVjb3JkLmRhdGFbIkV2ZW50Il1bIkV2ZW50RGF0YSJdWyJUYXJnZXRVc2VyU2lkIl0sCiAgICAgIHRhcmdldF91c2VybmFtZTogcmVjb3JkLmRhdGFbIkV2ZW50Il1bIkV2ZW50RGF0YSJdWyJUYXJnZXRVc2VyTmFtZSJdLAogICAgICB0YXJnZXRfZG9tYWluOiByZWNvcmQuZGF0YVsiRXZlbnQiXVsiRXZlbnREYXRhIl1bIlRhcmdldERvbWFpbk5hbWUiXSwKICAgICAgdHlwZTogcmVjb3JkLmRhdGFbIkV2ZW50Il1bIkV2ZW50RGF0YSJdWyJMb2dvblR5cGUiXSwKICAgICAgaG9zdG5hbWU6IHJlY29yZC5kYXRhWyJFdmVudCJdWyJFdmVudERhdGEiXVsiV29ya3N0YXRpb25OYW1lIl0sCiAgICAgIGlwX2FkZHJlc3M6IHJlY29yZC5kYXRhWyJFdmVudCJdWyJFdmVudERhdGEiXVsiSXBBZGRyZXNzIl0sCiAgICAgIHByb2Nlc3NfbmFtZTogcmVjb3JkLmRhdGFbIkV2ZW50Il1bIkV2ZW50RGF0YSJdWyJQcm9jZXNzTmFtZSJdLAogICAgICByYXc6IHJlY29yZAogICAgfTsKICAgIGxvZ29ucy5wdXNoKGVudHJ5KTsKICB9CiAgcmV0dXJuIGxvZ29uczsKfQptYWluKCk7Cg=="

[[artifacts]]
artifact_name = "script"
[artifacts.script]
name = "powershell"
# Parses PowerShell logs looking for EIDs 400,4104,4103, and 800
script = "Ly8gLi4vLi4vYXJ0ZW1pcy1hcGkvc3JjL3dpbmRvd3MvZXZlbnRsb2dzLnRzCmZ1bmN0aW9uIGdldF9ldmVudGxvZ3MocGF0aCkgewogIGNvbnN0IGRhdGEgPSBEZW5vW0Rlbm8uaW50ZXJuYWxdLmNvcmUub3BzLmdldF9ldmVudGxvZ3MocGF0aCk7CiAgY29uc3QgbG9nX2FycmF5ID0gSlNPTi5wYXJzZShkYXRhKTsKICByZXR1cm4gbG9nX2FycmF5Owp9CgovLyAuLi8uLi9hcnRlbWlzLWFwaS9tb2QudHMKZnVuY3Rpb24gZ2V0RXZlbnRMb2dzKHBhdGgpIHsKICByZXR1cm4gZ2V0X2V2ZW50bG9ncyhwYXRoKTsKfQoKLy8gbWFpbi50cwpmdW5jdGlvbiBtYWluKCkgewogIGNvbnN0IHBhdGhzID0gWwogICAgIkM6XFxXaW5kb3dzXFxTeXN0ZW0zMlxcd2luZXZ0XFxMb2dzXFxXaW5kb3dzIFBvd2VyU2hlbGwuZXZ0eCIsCiAgICAiQzpcXFdpbmRvd3NcXFN5c3RlbTMyXFx3aW5ldnRcXExvZ3NcXE1pY3Jvc29mdC1XaW5kb3dzLVBvd2VyU2hlbGwlNE9wZXJhdGlvbmFsLmV2dHgiCiAgXTsKICBjb25zdCBibG9ja3MgPSBbXTsKICBjb25zdCBwb3dlciA9IFtdOwogIGNvbnN0IGVpZHMgPSBbNDAwLCA4MDAsIDQxMDQsIDQxMDNdOwogIGZvciAoY29uc3QgcGF0aCBvZiBwYXRocykgewogICAgY29uc3QgcmVjb3JkcyA9IGdldEV2ZW50TG9ncyhwYXRoKTsKICAgIGZvciAoY29uc3QgcmVjb3JkIG9mIHJlY29yZHMpIHsKICAgICAgaWYgKCFlaWRzLmluY2x1ZGVzKHJlY29yZC5kYXRhWyJFdmVudCJdWyJTeXN0ZW0iXVsiRXZlbnRJRCJdKSAmJiAhZWlkcy5pbmNsdWRlcyhyZWNvcmQuZGF0YVsiRXZlbnQiXVsiU3lzdGVtIl1bIkV2ZW50SUQiXVsiI3RleHQiXSkpIHsKICAgICAgICBjb250aW51ZTsKICAgICAgfQogICAgICBpZiAocGF0aC5pbmNsdWRlcygiV2luZG93cyBQb3dlclNoZWxsLmV2dHgiKSkgewogICAgICAgIGNvbnN0IHBvd2Vyc2hlbGwgPSB7CiAgICAgICAgICB0aW1lc3RhbXA6IHJlY29yZC50aW1lc3RhbXAsCiAgICAgICAgICBkYXRhOiByZWNvcmQuZGF0YVsiRXZlbnQiXVsiRXZlbnREYXRhIl1bIkRhdGEiXVsiI3RleHQiXSwKICAgICAgICAgIHJhdzogcmVjb3JkCiAgICAgICAgfTsKICAgICAgICBwb3dlci5wdXNoKHBvd2Vyc2hlbGwpOwogICAgICB9IGVsc2UgewogICAgICAgIGNvbnN0IGJsb2NrID0gewogICAgICAgICAgdGltZXN0YW1wOiByZWNvcmQudGltZXN0YW1wLAogICAgICAgICAgcGF0aDogcmVjb3JkLmRhdGFbIkV2ZW50Il1bIkV2ZW50RGF0YSJdWyJQYXRoIl0sCiAgICAgICAgICB0ZXh0OiByZWNvcmQuZGF0YVsiRXZlbnQiXVsiRXZlbnREYXRhIl1bIlNjcmlwdEJsb2NrVGV4dCJdLAogICAgICAgICAgaWQ6IHJlY29yZC5kYXRhWyJFdmVudCJdWyJFdmVudERhdGEiXVsiU2NyaXB0QmxvY2tJZCJdLAogICAgICAgICAgcmF3OiByZWNvcmQKICAgICAgICB9OwogICAgICAgIGJsb2Nrcy5wdXNoKGJsb2NrKTsKICAgICAgfQogICAgfQogIH0KICBjb25zdCBsb2dzID0gewogICAgc2NyaXB0YmxvY2tzOiBibG9ja3MsCiAgICBwb3dlcnNoZWxsOiBwb3dlcgogIH07CiAgcmV0dXJuIGxvZ3M7Cn0KbWFpbigpOwo="
```

macOS TOML collection focusing on quickly collecting data related to a macOS
alert.

```toml
system = "macos"

[output]
name = "triage_collection"
directory = "./tmp"
format = "json"
compress = true
endpoint_id = "6c51b123-1522-4572-9f2a-0bd5abd81b82"
collection_id = 1
output = "local"
filter_name = "unifiedlogs_fsevents_filter"
# Filter for all logs and FsEvents that contain ".dmg" or "Downloads
filter_script="ZnVuY3Rpb24gZmlsdGVyTG9ncyhkYXRhKSB7CiAgY29uc3QgbG9ncyA9IFtdOwogIGNvbnN0IGxvZ0RhdGEgPSBKU09OLnBhcnNlKGRhdGEpOwogIGZvciAobGV0IGVudHJ5ID0gMDsgZW50cnkgPCBsb2dEYXRhLmxlbmd0aDsgZW50cnkrKykgewogICAgaWYgKCFsb2dEYXRhW2VudHJ5XS5tZXNzYWdlLmluY2x1ZGVzKCJEb3dubG9hZHMiKSAmJiAhbG9nRGF0YVtlbnRyeV0ubWVzc2FnZS5pbmNsdWRlcygiLmRtZyIpKSB7CiAgICAgIGNvbnRpbnVlOwogICAgfQogICAgbG9ncy5wdXNoKGxvZ0RhdGFbZW50cnldKTsKICB9CiAgcmV0dXJuIGxvZ3M7Cn0KZnVuY3Rpb24gZmlsdGVyRXZlbnRzKGRhdGEpIHsKICBjb25zdCBldmVudHMgPSBbXTsKICBjb25zdCBldmVudHNEYXRhID0gSlNPTi5wYXJzZShkYXRhKTsKICBmb3IgKGNvbnN0IGVudHJ5IG9mIGV2ZW50c0RhdGEpIHsKICAgIGlmICghZW50cnkucGF0aC5pbmNsdWRlcygiLmRtZyIpICYmICFlbnRyeS5wYXRoLmluY2x1ZGVzKCJEb3dubG9hZHMiKSkgewogICAgICBjb250aW51ZTsKICAgIH0KICAgIGV2ZW50cy5wdXNoKGVudHJ5KTsKICB9CiAgcmV0dXJuIGV2ZW50czsKfQoKZnVuY3Rpb24gbWFpbigpIHsKICBjb25zdCBhcmdzID0gRGVuby5hcmdzOwogIGlmIChhcmdzLmxlbmd0aCAhPSAyKSB7CiAgICByZXR1cm4gIm1pc3NpbmcgYXJncyIKICB9CiAgaWYgKGFyZ3NbMV0gPT09ICJ1bmlmaWVkbG9ncyIpIHsKICAgIHJldHVybiBmaWx0ZXJMb2dzKGFyZ3NbMF0pOwogIH0KICBpZiAoYXJnc1sxXSA9PT0gImZzZXZlbnRzZCIpIHsKICAgIHJldHVybiBmaWx0ZXJFdmVudHMoYXJnc1swXSk7CiAgfQoKICByZXR1cm4gSlNPTi5wYXJzZShhcmdzWzBdKTsKfQptYWluKCk7Cg=="

[[artifacts]]
artifact_name = "processes"
[artifacts.processes]
md5 = true
sha1 = false
sha256 = false
metadata = true

[[artifacts]]
artifact_name = "unifiedlogs"
filter = true
[artifacts.unifiedlogs]
sources = ["Persist"]

[[artifacts]]
artifact_name = "fseventsd"
filter = true

[[artifacts]]
artifact_name = "chromium-history"

[[artifacts]]
artifact_name = "chromium-downloads"

[[artifacts]]
artifact_name = "firefox-history"

[[artifacts]]
artifact_name = "firefox-downloads"

[[artifacts]]
artifact_name = "safari-history"

[[artifacts]]
artifact_name = "safari-downloads"
```
