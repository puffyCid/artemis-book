# Execution

Windows TOML collection to parse artifacts commonly associated with execution

```toml
system = "windows"

[output]
name = "execution_collection"
directory = "./tmp"
format = "json"
compress = true
endpoint_id = "6c51b123-1522-4572-9f2a-0bd5abd81b82"
collection_id = 1
output = "local"

[[artifacts]]
artifact_name = "prefetch"
[artifacts.prefetch]

[[artifacts]]
artifact_name = "amcache"
[artifacts.amcache]

[[artifacts]]
artifact_name = "shimcache"
[artifacts.shimcache]

[[artifacts]]
artifact_name = "userassist"
[artifacts.userassist]

[[artifacts]]
artifact_name = "script"
[artifacts.script]
name = "muicache"
script = "Ly8gLi4vLi4vYXJ0ZW1pcy1hcGkvc3JjL3dpbmRvd3MvcmVnaXN0cnkudHMKZnVuY3Rpb24gZ2V0X3JlZ2lzdHJ5KHBhdGgpIHsKICBjb25zdCBkYXRhID0gRGVub1tEZW5vLmludGVybmFsXS5jb3JlLm9wcy5nZXRfcmVnaXN0cnkocGF0aCk7CiAgY29uc3QgcmVnX2FycmF5ID0gSlNPTi5wYXJzZShkYXRhKTsKICByZXR1cm4gcmVnX2FycmF5Owp9CgovLyAuLi8uLi9hcnRlbWlzLWFwaS9tb2QudHMKZnVuY3Rpb24gZ2V0UmVnaXN0cnkocGF0aCkgewogIHJldHVybiBnZXRfcmVnaXN0cnkocGF0aCk7Cn0KCi8vIG1haW4udHMKZnVuY3Rpb24gbWFpbigpIHsKICBjb25zdCBkcml2ZSA9IERlbm8uZW52LmdldCgiU3lzdGVtRHJpdmUiKTsKICBpZiAoZHJpdmUgPT09IHZvaWQgMCkgewogICAgcmV0dXJuIFtdOwogIH0KICBjb25zdCBtdWlfYXJyYXkgPSBbXTsKICBjb25zdCB1c2VycyA9IGAke2RyaXZlfVxcVXNlcnNgOwogIGZvciAoY29uc3QgZW50cnkgb2YgRGVuby5yZWFkRGlyU3luYyh1c2VycykpIHsKICAgIHRyeSB7CiAgICAgIGNvbnN0IHBhdGggPSBgJHt1c2Vyc31cXCR7ZW50cnkubmFtZX1cXEFwcERhdGFcXExvY2FsXFxNaWNyb3NvZnRcXFdpbmRvd3NcXFVzckNsYXNzLmRhdGA7CiAgICAgIGNvbnN0IHN0YXR1cyA9IERlbm8ubHN0YXRTeW5jKHBhdGgpOwogICAgICBpZiAoIXN0YXR1cy5pc0ZpbGUpIHsKICAgICAgICBjb250aW51ZTsKICAgICAgfQogICAgICBjb25zdCByZWdfcmVzdWx0cyA9IGdldFJlZ2lzdHJ5KHBhdGgpOwogICAgICBmb3IgKGNvbnN0IHJlZ19lbnRyeSBvZiByZWdfcmVzdWx0cykgewogICAgICAgIGlmIChyZWdfZW50cnkucGF0aC5pbmNsdWRlcygiTG9jYWwgU2V0dGluZ3NcXFNvZnR3YXJlXFxNaWNyb3NvZnRcXFdpbmRvd3NcXFNoZWxsXFxNdWlDYWNoZSIpKSB7CiAgICAgICAgICBmb3IgKGNvbnN0IHZhbHVlIG9mIHJlZ19lbnRyeS52YWx1ZXMpIHsKICAgICAgICAgICAgaWYgKHZhbHVlLmRhdGFfdHlwZSAhPSAiUkVHX1NaIikgewogICAgICAgICAgICAgIGNvbnRpbnVlOwogICAgICAgICAgICB9CiAgICAgICAgICAgIGNvbnN0IG11aWNhY2hlID0gewogICAgICAgICAgICAgIGFwcGxpY2F0aW9uOiB2YWx1ZS52YWx1ZSwKICAgICAgICAgICAgICBkZXNjcmlwdGlvbjogdmFsdWUuZGF0YQogICAgICAgICAgICB9OwogICAgICAgICAgICBtdWlfYXJyYXkucHVzaChtdWljYWNoZSk7CiAgICAgICAgICB9CiAgICAgICAgfQogICAgICB9CiAgICB9IGNhdGNoIChfZSkgewogICAgICBjb250aW51ZTsKICAgIH0KICB9CiAgcmV0dXJuIG11aV9hcnJheTsKfQptYWluKCk7Cg=="

[[artifacts]]
artifact_name = "script"
[artifacts.script]
name = "eventlogs_4688"
script = "Ly8gLi4vLi4vYXJ0ZW1pcy1hcGkvc3JjL3dpbmRvd3MvZXZlbnRsb2dzLnRzCmZ1bmN0aW9uIGdldF9ldmVudGxvZ3MocGF0aCkgewogIGNvbnN0IGRhdGEgPSBEZW5vW0Rlbm8uaW50ZXJuYWxdLmNvcmUub3BzLmdldF9ldmVudGxvZ3MocGF0aCk7CiAgY29uc3QgbG9nX2FycmF5ID0gSlNPTi5wYXJzZShkYXRhKTsKICByZXR1cm4gbG9nX2FycmF5Owp9CgovLyAuLi8uLi9hcnRlbWlzLWFwaS9tb2QudHMKZnVuY3Rpb24gZ2V0RXZlbnRMb2dzKHBhdGgpIHsKICByZXR1cm4gZ2V0X2V2ZW50bG9ncyhwYXRoKTsKfQoKLy8gbWFpbi50cwpmdW5jdGlvbiBtYWluKCkgewogIGNvbnN0IHBhdGggPSAiQzpcXFdpbmRvd3NcXFN5c3RlbTMyXFx3aW5ldnRcXExvZ3NcXFNlY3VyaXR5LmV2dHgiOwogIGNvbnN0IHJlY29yZHMgPSBnZXRFdmVudExvZ3MocGF0aCk7CiAgY29uc3QgcHJvY2Vzc2VzID0gW107CiAgZm9yIChjb25zdCByZWNvcmQgb2YgcmVjb3JkcykgewogICAgaWYgKHJlY29yZC5kYXRhWyJFdmVudCJdWyJTeXN0ZW0iXVsiRXZlbnRJRCJdICE9IDQ2ODgpIHsKICAgICAgY29udGludWU7CiAgICB9CiAgICBwcm9jZXNzZXMucHVzaChyZWNvcmQpOwogIH0KICByZXR1cm4gcHJvY2Vzc2VzOwp9Cm1haW4oKTsK"
```
