# Scripts

A Windows collection script that does tha following:

- Parses and filters user Registry Run\RunOnce keys that contain the values: `["cmd.exe", "powershell", "temp", "appdata", "script"]`
- Parses and filters the System Event Log for service installs that contain the values: `[".bat", "powershell", "cmd.exe", "COMSPEC"]`
- Parses and filters BITS jobs looking for uncommon BITS jobs

```toml
system = "windows"

[output]
name = "win_filter"
directory = "./tmp"
format = "json"
compress = false
endpoint_id = "abdc"
collection_id = 1
output = "local"
filter_name = "regs_bits"
# This script will filter for sus Run\RunOnce Reg keys and non-builtin BITS jobs
filter_script = "Ly8gLi4vLi4vYXJ0ZW1pcy1hcGkvc3JjL3dpbmRvd3MvZXZlbnRsb2dzLnRzCmZ1bmN0aW9uIGdldF9ldmVudGxvZ3MocGF0aCkgewogIGNvbnN0IGRhdGEgPSBEZW5vW0Rlbm8uaW50ZXJuYWxdLmNvcmUub3BzLmdldF9ldmVudGxvZ3MocGF0aCk7CiAgY29uc3QgbG9nX2FycmF5ID0gSlNPTi5wYXJzZShkYXRhKTsKICByZXR1cm4gbG9nX2FycmF5Owp9CgovLyAuLi8uLi9hcnRlbWlzLWFwaS9tb2QudHMKZnVuY3Rpb24gZ2V0RXZlbnRMb2dzKHBhdGgpIHsKICByZXR1cm4gZ2V0X2V2ZW50bG9ncyhwYXRoKTsKfQoKLy8gbWFpbi50cwpmdW5jdGlvbiBncmFiRXZlbnRMb2dzKCkgewogIGNvbnN0IGRyaXZlID0gRGVuby5lbnYuZ2V0KCJTeXN0ZW1Ecml2ZSIpOwogIGlmIChkcml2ZSA9PT0gdm9pZCAwKSB7CiAgICByZXR1cm4gW107CiAgfQogIGNvbnN0IGRhdGEgPSBnZXRFdmVudExvZ3MoCiAgICBgJHtkcml2ZX1cXFdpbmRvd3NcXFN5c3RlbTMyXFx3aW5ldnRcXExvZ3NcXFN5c3RlbS5ldnR4YAogICk7CiAgY29uc3Qgc2VydmljZV9pbnN0YWxscyA9IFtdOwogIGNvbnN0IHN1c19zZXJ2aWNlcyA9IFsiLmJhdCIsICJwb3dlcnNoZWxsIiwgImNtZC5leGUiLCAiQ09NU1BFQyJdOwogIGZvciAoY29uc3QgcmVjb3JkIG9mIGRhdGEpIHsKICAgIGlmIChyZWNvcmQuZGF0YVsiRXZlbnQiXVsiU3lzdGVtIl1bIkV2ZW50SUQiXSAhPSA3MDQ1ICYmIHJlY29yZC5kYXRhWyJFdmVudCJdWyJTeXN0ZW0iXVsiRXZlbnRJRCJdWyIjdGV4dCJdICE9IDcwNDUpIHsKICAgICAgY29udGludWU7CiAgICB9CiAgICBpZiAocmVjb3JkLmRhdGFbIkV2ZW50Il1bIkV2ZW50RGF0YSJdWyJTZXJ2aWNlTmFtZSJdLmxlbmd0aCA9PT0gMTYgfHwgc3VzX3NlcnZpY2VzLnNvbWUoCiAgICAgICh2YWx1ZSkgPT4gcmVjb3JkLmRhdGFbIkV2ZW50Il1bIkV2ZW50RGF0YSJdWyJJbWFnZVBhdGgiXS50b0xvd2VyQ2FzZSgpLmluY2x1ZGVzKHZhbHVlKQogICAgKSkgewogICAgICBzZXJ2aWNlX2luc3RhbGxzLnB1c2gocmVjb3JkKTsKICAgIH0KICB9CiAgcmV0dXJuIHNlcnZpY2VfaW5zdGFsbHM7Cn0KZnVuY3Rpb24gZmlsdGVyUmVnaXN0cnkoZGF0YSkgewogIGNvbnN0IHJlZ3MgPSBKU09OLnBhcnNlKGRhdGEpOwogIGNvbnN0IHN1c19ydW5fa2V5cyA9IFsiY21kLmV4ZSIsICJwb3dlcnNoZWxsIiwgInRlbXAiLCAiYXBwZGF0YSIsICJzY3JpcHQiXTsKICBjb25zdCBzdXNfaGl0ID0gewogICAgcmVnaXN0cnlfZmlsZTogcmVncy5yZWdpc3RyeV9maWxlLAogICAgcmVnaXN0cnlfcGF0aDogcmVncy5yZWdpc3RyeV9wYXRoLAogICAgcmVnaXN0cnlfZW50cmllczogW10KICB9OwogIGZvciAoY29uc3QgcmVjb3JkIG9mIHJlZ3MucmVnaXN0cnlfZW50cmllcykgewogICAgaWYgKHJlY29yZC5uYW1lID09PSAiUnVuIiB8fCByZWNvcmQubmFtZSA9PT0gIlJ1bk9uY2UiKSB7CiAgICAgIGNvbnN0IHJlZ19oaXQgPSB7CiAgICAgICAga2V5OiByZWNvcmQua2V5LAogICAgICAgIG5hbWU6IHJlY29yZC5uYW1lLAogICAgICAgIHBhdGg6IHJlY29yZC5wYXRoLAogICAgICAgIHZhbHVlczogW10sCiAgICAgICAgbGFzdF9tb2RpZmllZDogcmVjb3JkLmxhc3RfbW9kaWZpZWQsCiAgICAgICAgZGVwdGg6IHJlY29yZC5kZXB0aAogICAgICB9OwogICAgICBmb3IgKGNvbnN0IHZhbHVlIG9mIHJlY29yZC52YWx1ZXMpIHsKICAgICAgICBpZiAoc3VzX3J1bl9rZXlzLnNvbWUoCiAgICAgICAgICAocmVnX3ZhbHVlKSA9PiB2YWx1ZS5kYXRhLnRvTG93ZXJDYXNlKCkuaW5jbHVkZXMocmVnX3ZhbHVlKQogICAgICAgICkpIHsKICAgICAgICAgIHJlZ19oaXQudmFsdWVzLnB1c2godmFsdWUpOwogICAgICAgIH0KICAgICAgfQogICAgICBpZiAocmVnX2hpdC52YWx1ZXMubGVuZ3RoID09PSAwKSB7CiAgICAgICAgY29udGludWU7CiAgICAgIH0KICAgICAgc3VzX2hpdC5yZWdpc3RyeV9lbnRyaWVzLnB1c2gocmVnX2hpdCk7CiAgICB9CiAgfQogIHJldHVybiBzdXNfaGl0Owp9CmZ1bmN0aW9uIGZpbHRlckJpdHMoZGF0YSkgewogIGNvbnN0IGJpdHNfZGF0YSA9IEpTT04ucGFyc2UoZGF0YSk7CiAgY29uc3Qgc3VzX2JpdHMgPSB7CiAgICBiaXRzOiBbXSwKICAgIGNhcnZlZF9maWxlczogW10sCiAgICBjYXJ2ZWRfam9iczogW10KICB9OwogIGNvbnN0IHN0YW5kYXJkX2JpdHMgPSBbCiAgICAibW96aWxsYSIsCiAgICAib3V0bG9vayIsCiAgICAiZWRnZSIsCiAgICAib25lZHJpdmUiLAogICAgImdvb2dsZSIsCiAgICAic3BlZWNoIgogIF07CiAgZm9yIChjb25zdCBiaXQgb2YgYml0c19kYXRhLmJpdHMpIHsKICAgIGlmICghc3RhbmRhcmRfYml0cy5zb21lKAogICAgICAodmFsdWUpID0+IGJpdC5mdWxsX3BhdGgudG9Mb3dlckNhc2UoKS5pbmNsdWRlcyh2YWx1ZSkKICAgICkgJiYgIXN0YW5kYXJkX2JpdHMuc29tZSgodmFsdWUpID0+IGJpdC51cmwudG9Mb3dlckNhc2UoKS5pbmNsdWRlcyh2YWx1ZSkpKSB7CiAgICAgIHN1c19iaXRzLmJpdHMucHVzaChiaXQpOwogICAgfQogIH0KICBmb3IgKGNvbnN0IGJpdCBvZiBiaXRzX2RhdGEuY2FydmVkX2ZpbGVzKSB7CiAgICBpZiAoIXN0YW5kYXJkX2JpdHMuc29tZSgKICAgICAgKHZhbHVlKSA9PiBiaXQuZnVsbF9wYXRoLnRvTG93ZXJDYXNlKCkuaW5jbHVkZXModmFsdWUpCiAgICApICYmICFzdGFuZGFyZF9iaXRzLnNvbWUoKHZhbHVlKSA9PiBiaXQudXJsLnRvTG93ZXJDYXNlKCkuaW5jbHVkZXModmFsdWUpKSkgewogICAgICBzdXNfYml0cy5jYXJ2ZWRfZmlsZXMucHVzaChiaXQpOwogICAgfQogIH0KICBmb3IgKGNvbnN0IGJpdCBvZiBiaXRzX2RhdGEuY2FydmVkX2pvYnMpIHsKICAgIGlmICghc3RhbmRhcmRfYml0cy5zb21lKAogICAgICAodmFsdWUpID0+IGJpdC50YXJnZXRfcGF0aC50b0xvd2VyQ2FzZSgpLmluY2x1ZGVzKHZhbHVlKQogICAgKSkgewogICAgICBzdXNfYml0cy5jYXJ2ZWRfam9icy5wdXNoKGJpdCk7CiAgICB9CiAgfQogIHJldHVybiBzdXNfYml0czsKfQpmdW5jdGlvbiBtYWluKCkgewogIGNvbnN0IGFyZ3MgPSBEZW5vLmFyZ3M7CiAgaWYgKGFyZ3MubGVuZ3RoIDwgMikgewogICAgcmV0dXJuIGdyYWJFdmVudExvZ3MoKTsKICB9CiAgaWYgKGFyZ3NbMV0gPT09ICJyZWdpc3RyeSIpIHsKICAgIHJldHVybiBmaWx0ZXJSZWdpc3RyeShhcmdzWzBdKTsKICB9CiAgaWYgKGFyZ3NbMV0gPT09ICJiaXRzIikgewogICAgcmV0dXJuIGZpbHRlckJpdHMoYXJnc1swXSk7CiAgfQogIHJldHVybiBKU09OLnBhcnNlKGFyZ3NbMF0pOwp9Cm1haW4oKTsK"

[[artifacts]]
artifact_name = "bits"
filter = true
[artifacts.bits]
carve = true

[[artifacts]]
artifact_name = "registry"
filter = true
[artifacts.registry]
user_hives = true
system_hives = false

[[artifacts]]
artifact_name = "script"
[artifacts.script]
name = "sus_7045_eids"
# The script below is the same as the filter script. Its coded in a manner that will work as a filter and normal script
script = "Ly8gLi4vLi4vYXJ0ZW1pcy1hcGkvc3JjL3dpbmRvd3MvZXZlbnRsb2dzLnRzCmZ1bmN0aW9uIGdldF9ldmVudGxvZ3MocGF0aCkgewogIGNvbnN0IGRhdGEgPSBEZW5vW0Rlbm8uaW50ZXJuYWxdLmNvcmUub3BzLmdldF9ldmVudGxvZ3MocGF0aCk7CiAgY29uc3QgbG9nX2FycmF5ID0gSlNPTi5wYXJzZShkYXRhKTsKICByZXR1cm4gbG9nX2FycmF5Owp9CgovLyAuLi8uLi9hcnRlbWlzLWFwaS9tb2QudHMKZnVuY3Rpb24gZ2V0RXZlbnRMb2dzKHBhdGgpIHsKICByZXR1cm4gZ2V0X2V2ZW50bG9ncyhwYXRoKTsKfQoKLy8gbWFpbi50cwpmdW5jdGlvbiBncmFiRXZlbnRMb2dzKCkgewogIGNvbnN0IGRyaXZlID0gRGVuby5lbnYuZ2V0KCJTeXN0ZW1Ecml2ZSIpOwogIGlmIChkcml2ZSA9PT0gdm9pZCAwKSB7CiAgICByZXR1cm4gW107CiAgfQogIGNvbnN0IGRhdGEgPSBnZXRFdmVudExvZ3MoCiAgICBgJHtkcml2ZX1cXFdpbmRvd3NcXFN5c3RlbTMyXFx3aW5ldnRcXExvZ3NcXFN5c3RlbS5ldnR4YAogICk7CiAgY29uc3Qgc2VydmljZV9pbnN0YWxscyA9IFtdOwogIGNvbnN0IHN1c19zZXJ2aWNlcyA9IFsiLmJhdCIsICJwb3dlcnNoZWxsIiwgImNtZC5leGUiLCAiQ09NU1BFQyJdOwogIGZvciAoY29uc3QgcmVjb3JkIG9mIGRhdGEpIHsKICAgIGlmIChyZWNvcmQuZGF0YVsiRXZlbnQiXVsiU3lzdGVtIl1bIkV2ZW50SUQiXSAhPSA3MDQ1ICYmIHJlY29yZC5kYXRhWyJFdmVudCJdWyJTeXN0ZW0iXVsiRXZlbnRJRCJdWyIjdGV4dCJdICE9IDcwNDUpIHsKICAgICAgY29udGludWU7CiAgICB9CiAgICBpZiAocmVjb3JkLmRhdGFbIkV2ZW50Il1bIkV2ZW50RGF0YSJdWyJTZXJ2aWNlTmFtZSJdLmxlbmd0aCA9PT0gMTYgfHwgc3VzX3NlcnZpY2VzLnNvbWUoCiAgICAgICh2YWx1ZSkgPT4gcmVjb3JkLmRhdGFbIkV2ZW50Il1bIkV2ZW50RGF0YSJdWyJJbWFnZVBhdGgiXS50b0xvd2VyQ2FzZSgpLmluY2x1ZGVzKHZhbHVlKQogICAgKSkgewogICAgICBzZXJ2aWNlX2luc3RhbGxzLnB1c2gocmVjb3JkKTsKICAgIH0KICB9CiAgcmV0dXJuIHNlcnZpY2VfaW5zdGFsbHM7Cn0KZnVuY3Rpb24gZmlsdGVyUmVnaXN0cnkoZGF0YSkgewogIGNvbnN0IHJlZ3MgPSBKU09OLnBhcnNlKGRhdGEpOwogIGNvbnN0IHN1c19ydW5fa2V5cyA9IFsiY21kLmV4ZSIsICJwb3dlcnNoZWxsIiwgInRlbXAiLCAiYXBwZGF0YSIsICJzY3JpcHQiXTsKICBjb25zdCBzdXNfaGl0ID0gewogICAgcmVnaXN0cnlfZmlsZTogcmVncy5yZWdpc3RyeV9maWxlLAogICAgcmVnaXN0cnlfcGF0aDogcmVncy5yZWdpc3RyeV9wYXRoLAogICAgcmVnaXN0cnlfZW50cmllczogW10KICB9OwogIGZvciAoY29uc3QgcmVjb3JkIG9mIHJlZ3MucmVnaXN0cnlfZW50cmllcykgewogICAgaWYgKHJlY29yZC5uYW1lID09PSAiUnVuIiB8fCByZWNvcmQubmFtZSA9PT0gIlJ1bk9uY2UiKSB7CiAgICAgIGNvbnN0IHJlZ19oaXQgPSB7CiAgICAgICAga2V5OiByZWNvcmQua2V5LAogICAgICAgIG5hbWU6IHJlY29yZC5uYW1lLAogICAgICAgIHBhdGg6IHJlY29yZC5wYXRoLAogICAgICAgIHZhbHVlczogW10sCiAgICAgICAgbGFzdF9tb2RpZmllZDogcmVjb3JkLmxhc3RfbW9kaWZpZWQsCiAgICAgICAgZGVwdGg6IHJlY29yZC5kZXB0aAogICAgICB9OwogICAgICBmb3IgKGNvbnN0IHZhbHVlIG9mIHJlY29yZC52YWx1ZXMpIHsKICAgICAgICBpZiAoc3VzX3J1bl9rZXlzLnNvbWUoCiAgICAgICAgICAocmVnX3ZhbHVlKSA9PiB2YWx1ZS5kYXRhLnRvTG93ZXJDYXNlKCkuaW5jbHVkZXMocmVnX3ZhbHVlKQogICAgICAgICkpIHsKICAgICAgICAgIHJlZ19oaXQudmFsdWVzLnB1c2godmFsdWUpOwogICAgICAgIH0KICAgICAgfQogICAgICBpZiAocmVnX2hpdC52YWx1ZXMubGVuZ3RoID09PSAwKSB7CiAgICAgICAgY29udGludWU7CiAgICAgIH0KICAgICAgc3VzX2hpdC5yZWdpc3RyeV9lbnRyaWVzLnB1c2gocmVnX2hpdCk7CiAgICB9CiAgfQogIHJldHVybiBzdXNfaGl0Owp9CmZ1bmN0aW9uIGZpbHRlckJpdHMoZGF0YSkgewogIGNvbnN0IGJpdHNfZGF0YSA9IEpTT04ucGFyc2UoZGF0YSk7CiAgY29uc3Qgc3VzX2JpdHMgPSB7CiAgICBiaXRzOiBbXSwKICAgIGNhcnZlZF9maWxlczogW10sCiAgICBjYXJ2ZWRfam9iczogW10KICB9OwogIGNvbnN0IHN0YW5kYXJkX2JpdHMgPSBbCiAgICAibW96aWxsYSIsCiAgICAib3V0bG9vayIsCiAgICAiZWRnZSIsCiAgICAib25lZHJpdmUiLAogICAgImdvb2dsZSIsCiAgICAic3BlZWNoIgogIF07CiAgZm9yIChjb25zdCBiaXQgb2YgYml0c19kYXRhLmJpdHMpIHsKICAgIGlmICghc3RhbmRhcmRfYml0cy5zb21lKAogICAgICAodmFsdWUpID0+IGJpdC5mdWxsX3BhdGgudG9Mb3dlckNhc2UoKS5pbmNsdWRlcyh2YWx1ZSkKICAgICkgJiYgIXN0YW5kYXJkX2JpdHMuc29tZSgodmFsdWUpID0+IGJpdC51cmwudG9Mb3dlckNhc2UoKS5pbmNsdWRlcyh2YWx1ZSkpKSB7CiAgICAgIHN1c19iaXRzLmJpdHMucHVzaChiaXQpOwogICAgfQogIH0KICBmb3IgKGNvbnN0IGJpdCBvZiBiaXRzX2RhdGEuY2FydmVkX2ZpbGVzKSB7CiAgICBpZiAoIXN0YW5kYXJkX2JpdHMuc29tZSgKICAgICAgKHZhbHVlKSA9PiBiaXQuZnVsbF9wYXRoLnRvTG93ZXJDYXNlKCkuaW5jbHVkZXModmFsdWUpCiAgICApICYmICFzdGFuZGFyZF9iaXRzLnNvbWUoKHZhbHVlKSA9PiBiaXQudXJsLnRvTG93ZXJDYXNlKCkuaW5jbHVkZXModmFsdWUpKSkgewogICAgICBzdXNfYml0cy5jYXJ2ZWRfZmlsZXMucHVzaChiaXQpOwogICAgfQogIH0KICBmb3IgKGNvbnN0IGJpdCBvZiBiaXRzX2RhdGEuY2FydmVkX2pvYnMpIHsKICAgIGlmICghc3RhbmRhcmRfYml0cy5zb21lKAogICAgICAodmFsdWUpID0+IGJpdC50YXJnZXRfcGF0aC50b0xvd2VyQ2FzZSgpLmluY2x1ZGVzKHZhbHVlKQogICAgKSkgewogICAgICBzdXNfYml0cy5jYXJ2ZWRfam9icy5wdXNoKGJpdCk7CiAgICB9CiAgfQogIHJldHVybiBzdXNfYml0czsKfQpmdW5jdGlvbiBtYWluKCkgewogIGNvbnN0IGFyZ3MgPSBEZW5vLmFyZ3M7CiAgaWYgKGFyZ3MubGVuZ3RoIDwgMikgewogICAgcmV0dXJuIGdyYWJFdmVudExvZ3MoKTsKICB9CiAgaWYgKGFyZ3NbMV0gPT09ICJyZWdpc3RyeSIpIHsKICAgIHJldHVybiBmaWx0ZXJSZWdpc3RyeShhcmdzWzBdKTsKICB9CiAgaWYgKGFyZ3NbMV0gPT09ICJiaXRzIikgewogICAgcmV0dXJuIGZpbHRlckJpdHMoYXJnc1swXSk7CiAgfQogIHJldHVybiBKU09OLnBhcnNlKGFyZ3NbMF0pOwp9Cm1haW4oKTsK"

```

A macOS collection script that does the following:

- Parses and filters the `Persist` UnifiedLog files for log messags that contain
  `sudo` or `osascript`
- Parses and filters Fseventsd entries for evidence of `.dmg` files or files in
  `/tmp`
- Parses and filters an App filelisting to list Applications and their
  associated `Info.plist` content
- Parses `LoginItems` and try to parse the associated persistence binary (if it
  exists and is a `macho` executable)

The script is coded in a manner so that it can run as a filter or a normal
script.

```toml
system = "macos"

[output]
name = "mac_filter"
directory = "./tmp"
format = "json"
compress = false
endpoint_id = "abdc"
collection_id = 1
output = "local"
filter_name = "unifiedlogs_fsevents_filter"
# This script will filter for unifiedlogs, fseventsd, and files
filter_script = "Ly8gLi4vLi4vYXJ0ZW1pcy1hcGkvc3JjL21hY29zL2xvZ2luaXRlbXMudHMKZnVuY3Rpb24gZ2V0X2xvZ2luaXRlbXMoKSB7CiAgY29uc3QgZGF0YSA9IERlbm9bRGVuby5pbnRlcm5hbF0uY29yZS5vcHMuZ2V0X2xvZ2luaXRlbXMoKTsKICBjb25zdCBpdGVtcyA9IEpTT04ucGFyc2UoZGF0YSk7CiAgcmV0dXJuIGl0ZW1zOwp9CgovLyAuLi8uLi9hcnRlbWlzLWFwaS9zcmMvbWFjb3MvbWFjaG8udHMKZnVuY3Rpb24gZ2V0X21hY2hvKHBhdGgpIHsKICBjb25zdCBkYXRhID0gRGVub1tEZW5vLmludGVybmFsXS5jb3JlLm9wcy5nZXRfbWFjaG8ocGF0aCk7CiAgaWYgKGRhdGEgPT09ICIiKSB7CiAgICByZXR1cm4gbnVsbDsKICB9CiAgY29uc3QgbWFjaG8gPSBKU09OLnBhcnNlKGRhdGEpOwogIHJldHVybiBtYWNobzsKfQoKLy8gLi4vLi4vYXJ0ZW1pcy1hcGkvc3JjL21hY29zL3BsaXN0LnRzCmZ1bmN0aW9uIGdldF9wbGlzdChwYXRoKSB7CiAgY29uc3QgZGF0YSA9IERlbm9bRGVuby5pbnRlcm5hbF0uY29yZS5vcHMuZ2V0X3BsaXN0KHBhdGgpOwogIGlmIChkYXRhID09PSAiIikgewogICAgcmV0dXJuIG51bGw7CiAgfQogIGNvbnN0IGxvZ19kYXRhID0gSlNPTi5wYXJzZShkYXRhKTsKICByZXR1cm4gbG9nX2RhdGE7Cn0KCi8vIC4uLy4uL2FydGVtaXMtYXBpL21vZC50cwpmdW5jdGlvbiBnZXRQbGlzdChwYXRoKSB7CiAgcmV0dXJuIGdldF9wbGlzdChwYXRoKTsKfQpmdW5jdGlvbiBnZXRNYWNobyhwYXRoKSB7CiAgcmV0dXJuIGdldF9tYWNobyhwYXRoKTsKfQpmdW5jdGlvbiBnZXRMb2dpbkl0ZW1zKCkgewogIHJldHVybiBnZXRfbG9naW5pdGVtcygpOwp9CgovLyBtYWluLnRzCmZ1bmN0aW9uIGdyYWJMb2dpbkl0ZW1zKCkgewogIGNvbnN0IGRhdGEgPSBnZXRMb2dpbkl0ZW1zKCk7CiAgY29uc3QgaXRlbXNNYWNobyA9IFtdOwogIGZvciAoY29uc3QgZW50cnkgb2YgZGF0YSkgewogICAgdHJ5IHsKICAgICAgY29uc3QgaXRlbSA9IHsKICAgICAgICBpdGVtczogZW50cnksCiAgICAgICAgbWFjaG86IGdldE1hY2hvKGVudHJ5LnBhdGguam9pbigiLyIpKQogICAgICB9OwogICAgICBpdGVtc01hY2hvLnB1c2goaXRlbSk7CiAgICB9IGNhdGNoIChfZSkgewogICAgICBjb25zdCBpdGVtID0gewogICAgICAgIGl0ZW1zOiBlbnRyeSwKICAgICAgICBtYWNobzogbnVsbAogICAgICB9OwogICAgICBpdGVtc01hY2hvLnB1c2goaXRlbSk7CiAgICB9CiAgfQogIHJldHVybiBpdGVtc01hY2hvOwp9CmZ1bmN0aW9uIGZpbHRlckxvZ3MoZGF0YSkgewogIGNvbnN0IGxvZ3MgPSBbXTsKICBjb25zdCBsb2dEYXRhID0gSlNPTi5wYXJzZShkYXRhKTsKICBmb3IgKGxldCBlbnRyeSA9IDA7IGVudHJ5IDwgbG9nRGF0YS5sZW5ndGg7IGVudHJ5KyspIHsKICAgIGlmICghbG9nRGF0YVtlbnRyeV0ubWVzc2FnZS5pbmNsdWRlcygic3VkbyIpICYmICFsb2dEYXRhW2VudHJ5XS5tZXNzYWdlLmluY2x1ZGVzKCJvc2FzY3JpcHQiKSkgewogICAgICBjb250aW51ZTsKICAgIH0KICAgIGxvZ3MucHVzaChsb2dEYXRhW2VudHJ5XSk7CiAgfQogIHJldHVybiBsb2dzOwp9CmZ1bmN0aW9uIGZpbHRlckV2ZW50cyhkYXRhKSB7CiAgY29uc3QgZXZlbnRzID0gW107CiAgY29uc3QgZXZlbnRzRGF0YSA9IEpTT04ucGFyc2UoZGF0YSk7CiAgZm9yIChjb25zdCBlbnRyeSBvZiBldmVudHNEYXRhKSB7CiAgICBpZiAoIWVudHJ5LnBhdGguaW5jbHVkZXMoIi5kbWciKSAmJiAhZW50cnkucGF0aC5zdGFydHNXaXRoKCIvdG1wIikpIHsKICAgICAgY29udGludWU7CiAgICB9CiAgICBldmVudHMucHVzaChlbnRyeSk7CiAgfQogIHJldHVybiBldmVudHM7Cn0KZnVuY3Rpb24gZmlsdGVyQXBwcyhkYXRhKSB7CiAgY29uc3QgYXBwcyA9IFtdOwogIGNvbnN0IGZpbGVzRGF0YSA9IEpTT04ucGFyc2UoZGF0YSk7CiAgZm9yIChsZXQgZW50cnkgPSAwOyBlbnRyeSA8IGZpbGVzRGF0YS5sZW5ndGg7IGVudHJ5KyspIHsKICAgIGlmIChmaWxlc0RhdGFbZW50cnldLmZ1bGxfcGF0aC5pbmNsdWRlcygiLmFwcCIpICYmIGZpbGVzRGF0YVtlbnRyeV0uZmlsZW5hbWUgIT0gIkluZm8ucGxpc3QiKSB7CiAgICAgIGNvbnRpbnVlOwogICAgfQogICAgY29uc3QgYXBwID0gewogICAgICBhcHBfcGF0aDogZmlsZXNEYXRhW2VudHJ5XS5kaXJlY3RvcnksCiAgICAgIGluZm9fcGxpc3Q6IGZpbGVzRGF0YVtlbnRyeV0uZnVsbF9wYXRoLAogICAgICBwbGlzdDogZ2V0UGxpc3QoZmlsZXNEYXRhW2VudHJ5XS5mdWxsX3BhdGgpCiAgICB9OwogICAgYXBwcy5wdXNoKGFwcCk7CiAgfQogIHJldHVybiBhcHBzOwp9CmZ1bmN0aW9uIG1haW4oKSB7CiAgY29uc3QgYXJncyA9IERlbm8uYXJnczsKICBpZiAoYXJncy5sZW5ndGggPCAyKSB7CiAgICByZXR1cm4gZ3JhYkxvZ2luSXRlbXMoKTsKICB9CiAgaWYgKGFyZ3NbMV0gPT09ICJ1bmlmaWVkbG9ncyIpIHsKICAgIHJldHVybiBmaWx0ZXJMb2dzKGFyZ3NbMF0pOwogIH0KICBpZiAoYXJnc1sxXSA9PT0gImZzZXZlbnRzZCIpIHsKICAgIHJldHVybiBmaWx0ZXJFdmVudHMoYXJnc1swXSk7CiAgfQogIGlmIChhcmdzWzFdID09PSAiZmlsZXMiKSB7CiAgICByZXR1cm4gZmlsdGVyQXBwcyhhcmdzWzBdKTsKICB9CiAgcmV0dXJuIEpTT04ucGFyc2UoYXJnc1swXSk7Cn0KbWFpbigpOwo="


[[artifacts]]
artifact_name = "unifiedlogs"
filter = true
[artifacts.unifiedlogs]
sources = ["Persist"]

[[artifacts]]
artifact_name = "fseventsd"
filter = true

[[artifacts]]
artifact_name = "files"
filter = true
[artifacts.files]
start_path = "/System/Volumes/Data/Applications"
depth = 15

[[artifacts]]
artifact_name = "script"
[artifacts.script]
name = "loginitems_macho" # No filtering applied
# The script below is the same as the filter script. Its coded in a manner that will work as a filter and normal script
script = "Ly8gLi4vLi4vYXJ0ZW1pcy1hcGkvc3JjL21hY29zL2xvZ2luaXRlbXMudHMKZnVuY3Rpb24gZ2V0X2xvZ2luaXRlbXMoKSB7CiAgY29uc3QgZGF0YSA9IERlbm9bRGVuby5pbnRlcm5hbF0uY29yZS5vcHMuZ2V0X2xvZ2luaXRlbXMoKTsKICBjb25zdCBpdGVtcyA9IEpTT04ucGFyc2UoZGF0YSk7CiAgcmV0dXJuIGl0ZW1zOwp9CgovLyAuLi8uLi9hcnRlbWlzLWFwaS9zcmMvbWFjb3MvbWFjaG8udHMKZnVuY3Rpb24gZ2V0X21hY2hvKHBhdGgpIHsKICBjb25zdCBkYXRhID0gRGVub1tEZW5vLmludGVybmFsXS5jb3JlLm9wcy5nZXRfbWFjaG8ocGF0aCk7CiAgaWYgKGRhdGEgPT09ICIiKSB7CiAgICByZXR1cm4gbnVsbDsKICB9CiAgY29uc3QgbWFjaG8gPSBKU09OLnBhcnNlKGRhdGEpOwogIHJldHVybiBtYWNobzsKfQoKLy8gLi4vLi4vYXJ0ZW1pcy1hcGkvc3JjL21hY29zL3BsaXN0LnRzCmZ1bmN0aW9uIGdldF9wbGlzdChwYXRoKSB7CiAgY29uc3QgZGF0YSA9IERlbm9bRGVuby5pbnRlcm5hbF0uY29yZS5vcHMuZ2V0X3BsaXN0KHBhdGgpOwogIGlmIChkYXRhID09PSAiIikgewogICAgcmV0dXJuIG51bGw7CiAgfQogIGNvbnN0IGxvZ19kYXRhID0gSlNPTi5wYXJzZShkYXRhKTsKICByZXR1cm4gbG9nX2RhdGE7Cn0KCi8vIC4uLy4uL2FydGVtaXMtYXBpL21vZC50cwpmdW5jdGlvbiBnZXRQbGlzdChwYXRoKSB7CiAgcmV0dXJuIGdldF9wbGlzdChwYXRoKTsKfQpmdW5jdGlvbiBnZXRNYWNobyhwYXRoKSB7CiAgcmV0dXJuIGdldF9tYWNobyhwYXRoKTsKfQpmdW5jdGlvbiBnZXRMb2dpbkl0ZW1zKCkgewogIHJldHVybiBnZXRfbG9naW5pdGVtcygpOwp9CgovLyBtYWluLnRzCmZ1bmN0aW9uIGdyYWJMb2dpbkl0ZW1zKCkgewogIGNvbnN0IGRhdGEgPSBnZXRMb2dpbkl0ZW1zKCk7CiAgY29uc3QgaXRlbXNNYWNobyA9IFtdOwogIGZvciAoY29uc3QgZW50cnkgb2YgZGF0YSkgewogICAgdHJ5IHsKICAgICAgY29uc3QgaXRlbSA9IHsKICAgICAgICBpdGVtczogZW50cnksCiAgICAgICAgbWFjaG86IGdldE1hY2hvKGVudHJ5LnBhdGguam9pbigiLyIpKQogICAgICB9OwogICAgICBpdGVtc01hY2hvLnB1c2goaXRlbSk7CiAgICB9IGNhdGNoIChfZSkgewogICAgICBjb25zdCBpdGVtID0gewogICAgICAgIGl0ZW1zOiBlbnRyeSwKICAgICAgICBtYWNobzogbnVsbAogICAgICB9OwogICAgICBpdGVtc01hY2hvLnB1c2goaXRlbSk7CiAgICB9CiAgfQogIHJldHVybiBpdGVtc01hY2hvOwp9CmZ1bmN0aW9uIGZpbHRlckxvZ3MoZGF0YSkgewogIGNvbnN0IGxvZ3MgPSBbXTsKICBjb25zdCBsb2dEYXRhID0gSlNPTi5wYXJzZShkYXRhKTsKICBmb3IgKGxldCBlbnRyeSA9IDA7IGVudHJ5IDwgbG9nRGF0YS5sZW5ndGg7IGVudHJ5KyspIHsKICAgIGlmICghbG9nRGF0YVtlbnRyeV0ubWVzc2FnZS5pbmNsdWRlcygic3VkbyIpICYmICFsb2dEYXRhW2VudHJ5XS5tZXNzYWdlLmluY2x1ZGVzKCJvc2FzY3JpcHQiKSkgewogICAgICBjb250aW51ZTsKICAgIH0KICAgIGxvZ3MucHVzaChsb2dEYXRhW2VudHJ5XSk7CiAgfQogIHJldHVybiBsb2dzOwp9CmZ1bmN0aW9uIGZpbHRlckV2ZW50cyhkYXRhKSB7CiAgY29uc3QgZXZlbnRzID0gW107CiAgY29uc3QgZXZlbnRzRGF0YSA9IEpTT04ucGFyc2UoZGF0YSk7CiAgZm9yIChjb25zdCBlbnRyeSBvZiBldmVudHNEYXRhKSB7CiAgICBpZiAoIWVudHJ5LnBhdGguaW5jbHVkZXMoIi5kbWciKSAmJiAhZW50cnkucGF0aC5zdGFydHNXaXRoKCIvdG1wIikpIHsKICAgICAgY29udGludWU7CiAgICB9CiAgICBldmVudHMucHVzaChlbnRyeSk7CiAgfQogIHJldHVybiBldmVudHM7Cn0KZnVuY3Rpb24gZmlsdGVyQXBwcyhkYXRhKSB7CiAgY29uc3QgYXBwcyA9IFtdOwogIGNvbnN0IGZpbGVzRGF0YSA9IEpTT04ucGFyc2UoZGF0YSk7CiAgZm9yIChsZXQgZW50cnkgPSAwOyBlbnRyeSA8IGZpbGVzRGF0YS5sZW5ndGg7IGVudHJ5KyspIHsKICAgIGlmIChmaWxlc0RhdGFbZW50cnldLmZ1bGxfcGF0aC5pbmNsdWRlcygiLmFwcCIpICYmIGZpbGVzRGF0YVtlbnRyeV0uZmlsZW5hbWUgIT0gIkluZm8ucGxpc3QiKSB7CiAgICAgIGNvbnRpbnVlOwogICAgfQogICAgY29uc3QgYXBwID0gewogICAgICBhcHBfcGF0aDogZmlsZXNEYXRhW2VudHJ5XS5kaXJlY3RvcnksCiAgICAgIGluZm9fcGxpc3Q6IGZpbGVzRGF0YVtlbnRyeV0uZnVsbF9wYXRoLAogICAgICBwbGlzdDogZ2V0UGxpc3QoZmlsZXNEYXRhW2VudHJ5XS5mdWxsX3BhdGgpCiAgICB9OwogICAgYXBwcy5wdXNoKGFwcCk7CiAgfQogIHJldHVybiBhcHBzOwp9CmZ1bmN0aW9uIG1haW4oKSB7CiAgY29uc3QgYXJncyA9IERlbm8uYXJnczsKICBpZiAoYXJncy5sZW5ndGggPCAyKSB7CiAgICByZXR1cm4gZ3JhYkxvZ2luSXRlbXMoKTsKICB9CiAgaWYgKGFyZ3NbMV0gPT09ICJ1bmlmaWVkbG9ncyIpIHsKICAgIHJldHVybiBmaWx0ZXJMb2dzKGFyZ3NbMF0pOwogIH0KICBpZiAoYXJnc1sxXSA9PT0gImZzZXZlbnRzZCIpIHsKICAgIHJldHVybiBmaWx0ZXJFdmVudHMoYXJnc1swXSk7CiAgfQogIGlmIChhcmdzWzFdID09PSAiZmlsZXMiKSB7CiAgICByZXR1cm4gZmlsdGVyQXBwcyhhcmdzWzBdKTsKICB9CiAgcmV0dXJuIEpTT04ucGFyc2UoYXJnc1swXSk7Cn0KbWFpbigpOwo="
```
